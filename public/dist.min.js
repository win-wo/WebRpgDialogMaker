app=angular.module("WebRpgDialogMaker",["ngRoute"]),app.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),app.config(["$routeProvider",function(e){e.when("/chapter",{templateUrl:"public/modules/chapters/index.html",controller:"ChapterPageController",controllerAs:"ChapterPage"}).otherwise({redirectTo:"/chapter"})}]),function(){function e(){var e=this;e.appName="Project Chaptr"}app.controller("AppController",e)}(),app.Data={},app.Models={},app.Utils={},app.Models.Chapter=function(){function e(e){e?this.DataContructor(e):this.Constructor()}return e.prototype.Constructor=function(){this.id=app.Utils.Guid.newGuid(),this.name=null,this.number=null,this.language=null,this.dialogs=[]},e.prototype.DataContructor=function(e){this.id=e.id,this.name=e.name,this.number=e.number,this.language=e.language,this.dialogs=e.dialogs},e.prototype.isValid=function(){if(!this.id)throw new Error("Missing id");if(!this.name)throw new Error("Missing name");if(!this.number)throw new Error("Missing number");if(!this.language)throw new Error("Missing language");if(!this.dialogs)throw new Error("Missing dialogs")},e.prototype.getFileName=function(){return this.number+"."+this.language+"."+app.Utils.Slug.slugify(this.name)+".json"},e}(),function(){function e(e){function t(){try{return JSON.parse(localStorage.chapter)}catch(e){return null}}function i(){localStorage.chapter=JSON.stringify(o.chapterData.chapter)}function a(e){try{var t=JSON.parse(e),a=new app.Models.Chapter(t);a.isValid(),o.chapterData.chapter=a,i(),location.reload()}catch(n){app.Data.Notifications.add("danger","File is not valid : "+n.message)}}var o=this;o.chapterData=app.Data.Chapter,o.chapterData.chapter=new app.Models.Chapter(t()),o.file=null,o.serializedChapterForExport=null,o.serializedChapterForVisualisation=null,o.exportedFileName=null,o.saveToStorage=function(){i()},o.importChapter=function(){try{var e=angular.element("#toolbar-file-import")[0];if(0==e.files.length)throw new Error("No file selected");var t=e.files[0],i=new FileReader;i.onload=function(e){a(i.result)},i.readAsText(t)}catch(o){app.Data.Notifications.add("danger","Impossible to import : "+o.message)}},o.exportChapter=function(){try{o.serializedChapterForExport=encodeURIComponent(JSON.stringify(o.chapterData.chapter)),o.exportedFileName=o.chapterData.chapter.getFileName()}catch(e){app.Data.Notifications.add("danger","Error while exporting : "+e.message)}},o.resetChapter=function(){o.chapterData.chapter=new app.Models.Chapter},o.updateSerializedChapterForVisualisation=function(){o.serializedChapterForVisualisation=JSON.stringify(o.chapterData.chapter,void 0,2)}}app.controller("ChapterPageController",e),e.$inject=["$location"]}(),app.Data.Chapter={},app.Data.Notifications={data:[],add:function(e,t){this.list.push({type:e,message:t})}},app.Models.Dialog=function(){function e(e){e?(this.id=e.id,this.name=e.name,this.number=e.number,this.messages=e.messages):(this.id=app.Utils.Guid.newGuid(),this.name=null,this.number=null,this.messages=[])}return e}(),function(){function e(){var e=this;e.chapterData=app.Data.Chapter,e.dialogModal={id:"#dialogModal",dialog:{},newMessage:{}};var t=new app.Utils.Repo(e.chapterData.chapter.dialogs),i=null;e.showDialogModal=function(t){e.dialogModal.dialog=new app.Models.Dialog(t),i=new app.Utils.Repo(e.dialogModal.dialog.messages),$(e.dialogModal.id).modal()},e.saveDialog=function(i){var a=new app.Models.Dialog(i);t.save(a),e.dialogModal.dialog={},$(e.dialogModal.id).modal("hide")},e.duplicateDialog=function(e){var i=new app.Models.Dialog(e);t.duplicate(i)},e.moveUpDialog=function(e){var i=new app.Models.Dialog(e);t.moveUp(i)},e.moveDownDialog=function(e){var i=new app.Models.Dialog(e);t.moveDown(i)},e.removeDialog=function(e){var i=new app.Models.Dialog(e);t.remove(i)},e.demoDialog=function(e){},e.saveMessage=function(){var t=new app.Models.Message(e.dialogModal.dialog.newMessage);i.save(t),e.dialogModal.dialog.newMessage={}},e.selectMessage=function(t){e.dialogModal.dialog.newMessage=new app.Models.Message(t)},e.duplicateMessage=function(e){var t=new app.Models.Message(e);i.duplicate(t)},e.moveUpMessage=function(e){var t=new app.Models.Message(e);i.moveUp(t)},e.moveDownMessage=function(e){var t=new app.Models.Message(e);i.moveDown(t)},e.removeMessage=function(e){var t=new app.Models.Message(e);i.remove(t)}}app.controller("DialogListController",e)}(),app.Models.Message=function(){function e(e){e?(this.id=e.id,this.character=e.character,this.text=e.text,this.choices=this.parseChoices(e.choices)):(this.id=app.Utils.Guid.newGuid(),this.character=null,this.text=null,this.choices=null,this.character=null)}return e.prototype.parseChoices=function(e){this.choices={}},e}(),function(){function e(){}app.controller("ToolbarController",e)}(),app.Utils.Guid=function(){function e(){}return e.newGuid=function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)});return e},e}(),app.Utils.Repo=function(){function e(e){this.items=e}return e.prototype.save=function(e){var t=_.findIndex(this.items,{id:e.id});-1!=t?this.items[t]=e:this.items.push(e)},e.prototype.duplicate=function(e){var t=_.findIndex(this.items,{id:e.id});e.id=app.Utils.Guid.newGuid(),this.items.splice(t,0,e)},e.prototype.remove=function(e){_.remove(this.items,{id:e.id})},e.prototype.get=function(){},e.prototype.getAll=function(){},e.prototype.moveUp=function(e){var t=_.findIndex(this.items,{id:e.id});if(0!=t){var i=this.items[t],a=this.items[t-1];this.items[t]=a,this.items[t-1]=i}},e.prototype.moveDown=function(e){var t=_.findIndex(this.items,{id:e.id});if(t!=this.items.length-1){var i=this.items[t],a=this.items[t+1];this.items[t]=a,this.items[t+1]=i}},e}(),app.Utils.Slug=function(){function e(){}return e.slugify=function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},e}(),function(){function e(){var e=this;e.notifications=app.Data.Notifications.data,e.removeNotification=function(t){e.notifications.splice(t,1)}}app.controller("NotificationsController",e)}();
//# sourceMappingURL=dist.min.js.map
