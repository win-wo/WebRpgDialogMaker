app=angular.module("WebRpgDialogMaker",["ngRoute"]),app.config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|data):/)}]),app.config(["$routeProvider",function(a){a.when("/chapter",{templateUrl:"public/modules/chapters/index.html",controller:"ChapterPageController",controllerAs:"ChapterPage"}).otherwise({redirectTo:"/chapter"})}]),function(){function a(){var a=this;a.appName="Project Chaptr"}app.controller("AppController",a)}(),app.Data={},app.Models={},app.Utils={},app.Models.Chapter=function(){function a(a){a?this.DataContructor(a):this.Constructor()}return a.prototype.Constructor=function(){this.id=app.Utils.Guid.newGuid(),this.name=null,this.number=null,this.language=null,this.dialogs=[]},a.prototype.DataContructor=function(a){this.id=a.id,this.name=a.name,this.number=a.number,this.language=a.language,this.dialogs=a.dialogs},a.prototype.isValid=function(){if(!this.id)throw new Error("Missing id");if(!this.name)throw new Error("Missing name");if(!this.number)throw new Error("Missing number");if(!this.language)throw new Error("Missing language");if(!this.dialogs)throw new Error("Missing dialogs")},a.prototype.getFileName=function(){return this.number+"."+this.language+"."+app.Utils.Slug.slugify(this.name)+".json"},a}(),function(){function a(a){function t(){try{return JSON.parse(localStorage.chapter)}catch(a){return null}}function i(){localStorage.chapter=JSON.stringify(o.chapterData.chapter)}function e(a){try{var t=JSON.parse(a),e=new app.Models.Chapter(t);e.isValid(),o.chapterData.chapter=e,i(),location.reload()}catch(r){app.Data.Notifications.add("danger","File is not valid : "+r.message)}}var o=this;o.chapterData=app.Data.Chapter,o.chapterData.chapter=new app.Models.Chapter(t()),o.file=null,o.serializedChapterForExport=null,o.serializedChapterForVisualisation=null,o.exportedFileName=null,o.saveToStorage=function(){i()},o.importChapter=function(){try{var a=angular.element("#toolbar-file-import")[0];if(0==a.files.length)throw new Error("No file selected");var t=a.files[0],i=new FileReader;i.onload=function(a){e(i.result)},i.readAsText(t)}catch(o){app.Data.Notifications.add("danger","Impossible to import : "+o.message)}},o.exportChapter=function(){try{o.serializedChapterForExport=encodeURIComponent(JSON.stringify(o.chapterData.chapter)),o.exportedFileName=o.chapterData.chapter.getFileName()}catch(a){app.Data.Notifications.add("danger","Error while exporting : "+a.message)}},o.resetChapter=function(){o.chapterData.chapter=new app.Models.Chapter},o.updateSerializedChapterForVisualisation=function(){o.serializedChapterForVisualisation=JSON.stringify(o.chapterData.chapter,void 0,2)}}app.controller("ChapterPageController",a),a.$inject=["$location"]}(),app.Data.Chapter={},app.Data.Notifications={data:[],add:function(a,t){this.list.push({type:a,message:t})}},function(){function a(){var a=this;a.chapterData=app.Data.Chapter,a.dialogModal={id:"#dialogModal",dialog:{}},a.showDialogModal=function(t){angular.copy(t,a.dialogModal.dialog),$(a.dialogModal.id).modal()},a.saveDialog=function(t){var i={};angular.copy(t,i),i.id=i.id||app.Utils.Guid.newGuid();var e=_.findIndex(a.chapterData.chapter.dialogs,{id:i.id});-1!=e?a.chapterData.chapter.dialogs[e]=i:a.chapterData.chapter.dialogs.push(i),$(a.dialogModal.id).modal("hide")},a.selectDialog=function(t){a.updateDialogWindowVisible,angular.copy(t,a.dialogModal.dialog)},a.deleteDialog=function(t){_.remove(a.chapterData.chapter.dialogs,{id:t.id})},a.demoDialog=function(a){}}app.controller("DialogListController",a)}(),function(){function a(){var a=this;a.notifications=app.Data.Notifications.data,a.removeNotification=function(t){a.notifications.splice(t,1)}}app.controller("NotificationsController",a)}(),function(){function a(){}app.controller("ToolbarController",a)}(),app.Utils.Guid=function(){function a(){}return a.newGuid=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var t=16*Math.random()|0,i="x"==a?t:3&t|8;return i.toString(16)});return a},a}(),app.Utils.Slug=function(){function a(){}return a.slugify=function(a){return a.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},a}();
//# sourceMappingURL=dist.min.js.map
